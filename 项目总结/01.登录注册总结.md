## 注册

1. 首先是获取验证码，获取验证码需要有手机号，所以手机号得有值发送验证码，然后就是三连环。
2. 需要注意的是需要根据请求是成功还是失败才有后续操作，所以 action 函数里面必须有 return。

## 登录

1. 账号密码正确服务端会传一个 token 给客户端，我们将其用 vuex 存起来，先初始给 token 一个空串，暂时不考虑后期存储的问题，那是自动登录应该考虑的。
2. action 也需要 return，登录成功会跳转到首页。
3. 用 token 获取用户信息，三连环，获取完之后就要进行 token 校验了。
4. 这里用路由导航守卫来校验，路由导航前置守卫用得比较多，所以用它。

```js
router.beforeEach((to, from, next) => {...}
to：代表将要跳转的路由对象
from：代表当前的路由对象
next：控制路由跳转的方法
	1. 什么都不填：无限制跳转
    2. 路径或对象：往填写的参数跳转
    3. false：中断当前的导航
```

5. 校验逻辑：
   1. 首先判断当前路由有没有 token，如果没有，则暂时先不限制，即：next()。
   2. 有 token，接着判断当前页面是否是 login，因为有了 token 暂时就不用重复登陆了，所以不能跳到 login 页面，所以就 next('/')。
   3. 不在 login 页面，接着判断有没有用户信息 userInfo，因为userInfo初始是个对象，所以得判断里面的任意一个属性，如果有，则不限制，如果没有，则获取用户信息 。
   4.  如果用户信息获取成功，则不限制，如失败，则统一认为 token 过期已失效，需要清除 token 和用户信息，并跳转到 login 页面。

## 自动登录

1. 因为我们是用 vuex 存的 token，所以页面刷新相当于项目重启， token 自然就没有了，只有再次登录才有，所以就要用到 localStorage。
2. 登录的时候将 token 设置到 localStorage 上，然后 token 用 localStorage 获取，但是不能去掉 commit，因为第一次是拿不到localStorage中的数据的，这样我们刚登录上去跳转到首页时就会不显示用户信息，得刷新之后才更新。
3. 用户信息获取失败，清空 token 的时候不但要清空 state 里面的 token和 而且要清空 localStorage 当中 token。

## 退出登录

1. 需要注意的是清除 token 时要将 state 中的 token和userInfo 都清除掉，不要忘了 localStorage 中的token也要清除掉。
2. 所以校验时信息获取失败时也需要调用 store.dispatch 清除掉 token。

## userTempld 和 token 的区别

- userTempled 主要是未登陆的时候用户的身份标识。
- token 就是登录时的用户标识。
- 如果没登录，请求头中只有临时标识 userTempled，添加的购物车信息就是临时标识的信息。
- 如果登录了，那么我们同时在请求头中添加临时标识和登录后标识，后台就会把临时标识的信息转移到登录后标识中，临时标识的信息就不见了。
- 两个标识都存在的话，后台会合并临时 id 对应的信息到 token 对应的信息上去，token 才是老大。